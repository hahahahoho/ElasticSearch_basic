# ElasticSearch 개념

안녕하세요. 오랫만의 포스팅입니다. 

엘라스틱서치를 사용하는 것이 간단하지 않을 뿐더러 일이 많다보니 텀이 길어졌네요 ㅜㅜ

그럼 엘라스틱 서치에 대해서 알아보고 어떻게 사용할지에 대해서 알아보도록 하겠습니다.

#### 엘라스틱 서치란 아파치 루신(Apache Lucene)을 기반으로 개발된 오픈소스 분산 검색엔진 서버입니다. JSON기반의 비정형 데이터 분산검색과 분석을 지원하며, 설치와 서버확장이 편리하고 검색이 빠르다는 장점을 갖고 있습니다. 국내외 대기업에서도 많은 곳에서 사용되고 있습니다.

자! 정의는 보았으니 먼저 이해를 하고 가겠습니다. 엘라스틱서치는 위에서 서버라고 되어있는데, 서버이자 DataBase입니다. JSON형태로 기존 rdbms와는 별개로 데이터를 관리할 수 있습니다. 

아~ 그럼 엘라스틱서치를 사용하면 db는 필요가 없겠네? 라고 생각하실 수 있습니다. 반은 맞고 반은 틀렸다고 할 수 있습니다. 엘라스틱서치는 검색을 위한, 오로지 검색을 위하고 있습니다. 즉, 수정과 입력, 삭제에서는 많은 리소스를 사용하기 때문에 느립니다!  그리고 데이터분실의 위험이 보다 크다고 합니다. 

그러면 어떻게 사용해야 하나요? 기존 RDBMS를 통해 원본 데이터를 관리하고 빠른 검색이 필요한 곳에서만 적용하여 사용하시면 됩니다. RDBMS와는 약간의 싱크 오차가 생길 수 있지만, 빠른 검색이 필요한 곳에서는 이 정도는 보통 넘어갈 수 있는 수준일 것 입니다. 

다시 말해, 동작에 대해서 설명드리면 기존 RDBMS를 통해 데이터를 조작하고, 엘라스틱서치는 정해진 시간(5분이든, 10분이든, 1시간이든, 1일이든) 바뀐 원본데이터를 재인덱싱하여 반영하는 것 입니다. 실시간으로 변경할 수도 있지만 어느 정도의 텀을 두는 것이 더 효율적으로 엘라스틱서치 서버를 이용하는 것이라고 합니다. 

## 설치방법

1. java 설치 및 path설정

   - 기본적으로 엘라스틱서치는 자바가상머신 환경으로 돌아가기 때문에 jdk를 설치해주어야 합니다. 1.8버전을 권장한다고 합니다

   참조 : https://blog.naver.com/iris_bhj/221403199135

   위 주소로 가시면 상세하게 설명되어 있습니다. ^^

   

2. 엘라스틱서치 다운로드

다운로드 주소 : https://www.elastic.co/kr/downloads/elasticsearch

![](.\image\download_address.png)

os환경에 맞는 파일을 다운로드 하신 후 압축을 푸시면 설치는 끝납니다.

다운이 완료 되었으니 이제 실행시켜봐야겠죠??? 압축을 해제한 폴더 경로로 이동하여 bin폴더의 elasticsearch.bat파일을 실행시킵니다. 순서대로 잘 진행하였다면 웹브라우저 창에 localhost:9200을 입력하시면 404 not found가 아닌 엘라스틱서치 정보가 json형태로 뿌려지게 될 것 입니다.



3. 한글 형태소 분석기 nori 설치

대한민국 사람이기에... 한글 형태소 분석기를 꼭 설치해줍시다. 물론! 외국사이트의 경우는 필요 없겠지요??? 설치방법은

` elasticsearch path/bin/elasticsearch-plugin install analysis-nori` 

엘라스틱서치 bin 폴더에서 elasticseach-plugin install analysis-nori 라고 입력해주시면!! 설치가 됩니다

설치가 완료되었으면, elasticsearch.bat파일을 재실행 한 후 위로 조금 올라와 보시면

![](.\image\nori_run.png)

위에처럼 plugin이 동작하는 모습을 확인할 수 있습니다 ^^.

## 개념심화

실제 사용하는 메서들을 설명함에 앞서, 알아두어야할 용어와 개념들에 대해서 설명드리겠습니다.

index : database명과 대응합니다.

type :  table명과 대응합니다.

document : 각 각의 row 행들과 대응합니다. 

여지까지 RDBMS를 사용하신분은 serach시에 database ->table->filed->값 순서로 서치하는 순으로 익숙하실 겁니다. 

엘라스틱서치는 index->type->값(text)->document 순이라고 생각하면 될까요?? 이 부분은 저도 정확한지는 확신을 못드리겠네요 ㅜㅜ. 설명을 드리면 엘라스틱서치는 기본적으로 text(값)을 분석하여 조사나 이런부분을 빼고 단어단위로 인덱싱을 합니다. the apple is born이라고 하면 apple과 born을 인덱싱하고 이 단어가 들어있는 문서번호를 저장하게 됩니다.

apple : 1번 document, 11번 document

born : 1번 document, 23번 document, 45번 document 

마치 위에 예시처럼요. 그래서 엘라스틱서치는 검색시에 rest방식으로 

```
curl -H "Content-Type: application/json" -XGET
'http://localhost:9200/index명/type명/_search(옵션)' -d '{
  "query": {
    "match": {
      "fruit": "apple"
    }
  },
  "aggregations": {
    "top_10_states": {
      "terms": {
        "field": "state",
        "size": 10
      }
    }
  }
}'
```

위에처럼 요청을 하게 됩니다. 그러면 엘라스틱서치는 해당 인덱스명의 타입명에서 인덱싱 되어있는 텍스트 apple과 단어를 찾고 매칭되는 document( =row )을 찾습니다 . 그리고 document에서 type이 fruit인 것을 찾아 값에 apple이 있으면 해당 document를 리턴합니다.

그리고 우리는 받은 document로부터 필요한 필드를 검색하여 꺼내는 것입니다. 조금 이해하기 어렵죠? 쉽게 설명하고 싶은데, 잘 안되네요.. ㅜㅜ

정리하면, 기존 RDBMS는 효율적인 sql문을 작성하지 않으면 모든열을 탐색하기에 느린반면, 엘라스틱 서치는 과정이 조금 복잡해 보이더라도 텍스트를 먼저 찾고 그 로우에 접근하는 방식이기에 항상 성능을 유지할 수 있습니다. 

또한 엘라스틱서치에서는 단어 중요도에 따라 순서정렬을 하거나 다양한 메서드를 다양한 알고리즘을 통해 구현해 놓았으므로 한 번 배워놓으면 굉장히 효율적인 검색을 가능하게 만들어주기 때문에 검색이 중요한 프로젝트라면 사용하는 것이 작업효율을 굉장히 높혀줄 것이라 저는 생각합니다.



후우..... 메서드들에 대해서는 하나도 설명안했는데 이렇게 길어지네요 ㅠㅠ....

주로 사용하는 메서드들에 대한 설명과 사용방법은 다음 시간에 올리도록 하겠습니다! 

긴 글 읽어주셔서 감사합니다 ^^

